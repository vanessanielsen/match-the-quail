<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Quail Matching Quiz</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

  <div id="timer" style="
    position: fixed;
    top: 20px;
    right: 20px;
    background: #0078d4;
    color: white;
    padding: 8px 14px;
    border-radius: 8px;
    font-weight: 600;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    user-select: none;
    z-index: 1000;
  ">
    Time: 0.0s
  </div>

  <div class="user-greeting">
    <div id="birdIcon" class="bird-icon">üê¶</div>
    <div>{{ user_email }}</div>
  </div>
  <h2>Match each baby quail to the adult quail</h2>
  <p>Choose the letter (A‚ÄìF) for the adult you think matches each chick. Your time will be recorded.</p>

  <form id="quizForm" method="post" action="{{ url_for('submit') }}">
    <div class="grid">

      {% for idx, baby in enumerate(babies, start=1) %}
      <div class="baby">
        <a href="{{ url_for('static', filename=baby) }}" target="_blank" rel="noopener noreferrer">
          <img class="preview" src="{{ url_for('static', filename=baby) }}" alt="Baby {{ idx }}" />
        </a>
        <label for="answer_{{ idx }}">Baby {{ idx }}</label>
        <select name="answer_{{ idx }}" id="answer_{{ idx }}" required>
          <option value="" disabled selected>Select adult</option>
          {% for a_idx in range(1, num + 1) %}
          <option value="{{ a_idx }}">{{ chr(64 + a_idx) }}</option>
          {% endfor %}
        </select>
      </div>
      {% endfor %}

    </div>

<div class="adults-section">
  <h2>Adult Quails</h2>
  <div class="grid adults">
    {% for a_idx, adult in enumerate(adults, start=1) %}
      <div class="adult">
        <img class="preview" src="{{ url_for('static', filename=adult) }}" alt="Adult {{ a_idx }}" />
        <label>{{ chr(64 + a_idx) }}</label> <!-- This gives A, B, C... -->
      </div>
    {% endfor %}
  </div>
</div>

    <input type="hidden" name="time_seconds" id="time_seconds" value="0" />

    <div class="submit-row">
      <button type="submit">Submit answers</button>
    </div>
  </form>

<script>
  let startTs = null;
  let timerInterval = null;
  const timerEl = document.getElementById('timer');

  function startTimer() {
    if (!startTs) {
      startTs = Date.now();
      timerEl.style.display = 'block';
      timerInterval = setInterval(() => {
        const elapsed = (Date.now() - startTs) / 1000;
        timerEl.textContent = `Time: ${elapsed.toFixed(1)}s`;
      }, 100);
    }
  }

  const form = document.getElementById('quizForm');
  form.addEventListener('change', startTimer, { once: true });
  form.addEventListener('click', startTimer, { once: true });

  form.addEventListener('submit', function () {
    clearInterval(timerInterval);
    const elapsed = startTs ? (Date.now() - startTs) / 1000.0 : 0;
    document.getElementById('time_seconds').value = elapsed.toFixed(2);
  });
</script>

</body>
</html>
