<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Quail Matching Quiz</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

  <div id="timer" class="timer">Time: 0.0s</div>

  <div class="user-greeting">
    <div id="birdIcon" class="bird-icon">üê¶</div>
    <div>{{ user_email }}</div>
  </div>

  <h2>Match Each Baby Quail to Its Adult</h2>
  <p>Select the letter (A‚ÄìF) that corresponds to the adult quail you think matches each chick.</p>
  <p>Your time will be tracked‚Äîtry to be both fast and accurate.</p>

  <form id="quizForm" method="post" action="{{ url_for('submit') }}">

    <div class="image-grid">
      {% for idx, baby in enumerate(babies, start=1) %}
      <div class="image-card baby">
        <a href="{{ url_for('static', filename=baby) }}" target="_blank" rel="noopener noreferrer">
          <img src="{{ url_for('static', filename=baby) }}" alt="Baby {{ idx }}" />
        </a>
        <select name="answer_{{ idx }}" id="answer_{{ idx }}" required>
          <option value="" disabled selected>Select adult</option>
          {% for a_idx in range(1, num + 1) %}
          <option value="{{ a_idx }}">{{ chr(64 + a_idx) }}</option>
          {% endfor %}
        </select>
      </div>
      {% endfor %}
    </div>

    <div class="adults-section">
      <h2>Adult Quails</h2>
      <div class="image-grid adults">
        {% for a_idx, adult in enumerate(adults, start=1) %}
        <div class="image-card adult">
          <a href="{{ url_for('static', filename=adult) }}" target="_blank" rel="noopener noreferrer">
            <img src="{{ url_for('static', filename=adult) }}" alt="Adult {{ a_idx }}" />
          </a>
          <label>{{ chr(64 + a_idx) }}</label>
        </div>
        {% endfor %}
      </div>
    </div>

    <input type="hidden" name="time_seconds" id="time_seconds" value="0" />

    <div class="submit-row">
      <br>
      <button type="submit">Submit answers</button>
    </div>

  </form>

<script>
  let startTs = null;
  let timerInterval = null;
  const timerEl = document.getElementById('timer');
  const maxTime = 60; // seconds

  function startTimer() {
    if (!startTs) {
      startTs = Date.now();
      timerEl.style.display = 'block';
      timerInterval = setInterval(() => {
        const elapsed = (Date.now() - startTs) / 1000;
        timerEl.textContent = `Time: ${elapsed.toFixed(1)}s`;

        let intensity = Math.min(elapsed / maxTime, 1);
        // Interpolate from light red (e.g. rgb(255, 153, 153)) to bright red (rgb(255, 0, 0))
        let greenBlueValue = Math.floor(153 * (1 - intensity));
        timerEl.style.backgroundColor = `rgb(255, ${greenBlueValue}, ${greenBlueValue})`;
      }, 100);
    }
  }

  const form = document.getElementById('quizForm');
  form.addEventListener('change', startTimer, { once: true });
  form.addEventListener('click', startTimer, { once: true });

  form.addEventListener('submit', function () {
    clearInterval(timerInterval);
    const elapsed = startTs ? (Date.now() - startTs) / 1000.0 : 0;
    document.getElementById('time_seconds').value = elapsed.toFixed(2);
  });
</script>

</body>
</html>
